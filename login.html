<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Login - JAYU STR</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body {
      background: #0f0f0f; color: white; font-family: Arial; padding: 20px;
      display: flex; justify-content: center; flex-wrap: wrap; gap: 30px;
    }
    .container, .public-box {
      background: #1c1c1c; padding: 20px; border-radius: 10px; max-width: 400px;
    }
    h2 { color: #1DB954; text-align: center; }
    input, button {
      width: 100%; padding: 10px; margin-top: 10px;
      background: #2c2c2c; color: white; border: none; border-radius: 5px;
    }
    .song-card {
      background: #292929; margin-bottom: 15px; padding: 10px; border-radius: 5px;
    }
    iframe { width: 100%; height: 200px; border: none; }
    .btn { background: #1DB954; font-weight: bold; cursor: pointer; }
    a { color: #1DB954; text-align: center; display: block; margin-top: 15px; }
  </style>
</head>
<body>

  <div class="container">
    <h2>Login</h2>
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Password" required />
    <button class="btn" onclick="login()">Login</button>
    <a href="registration.html">Don't have an account? Register here</a>
  </div>

  <div class="public-box">
    <h2>ðŸŽµ Public Songs</h2>
    <div id="publicSongs">Loading...</div>
  </div>

  <script>
    // TODO: Replace with your Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          alert("Login successful!");
          window.location.href = "profile.html";
        })
        .catch(error => {
          alert("Login failed: " + error.message);
        });
    }

    function extractID(linkOrId) {
      const match = linkOrId.match(/(?:v=|\/)([0-9A-Za-z_-]{11})/);
      return match ? match[1] : linkOrId;
    }

    function loadPublicSongs() {
      const container = document.getElementById("publicSongs");
      db.ref("songs").once("value", snapshot => {
        const songs = snapshot.val();
        container.innerHTML = "";
        if (songs) {
          Object.values(songs).forEach(song => {
            const vid = extractID(song.id);
            const div = document.createElement("div");
            div.className = "song-card";
            div.innerHTML = `
              <h4>${song.title}</h4>
              <p>Category: ${song.category}</p>
              <iframe src="https://www.youtube.com/embed/${vid}" allowfullscreen></iframe>
              <a href="https://api.vevioz.com/@api/button/mp3/${vid}" target="_blank">
                <button class="btn">Download MP3</button>
              </a>
            `;
            container.appendChild(div);
          });
        } else {
          container.innerText = "No songs found.";
        }
      });
    }

    loadPublicSongs();
  </script>
</body>
</html>
